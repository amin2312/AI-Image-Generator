(function(e){"use strict";e["acsv"]=e["acsv"]||{};var g=function(){};g.replace=function(e,t,r){return e.split(t).join(r)};var x=e["acsv"]["Field"]=function(){};var A=e["acsv"]["Table"]=function(){this._selector=null;this._indexSet={};this.body=[];this.head=[];this.content=null};A.Parse=function(e,t,r){if(r==null){r='"'}if(t==null){t=","}var i=A.arrayToRows(A.textToArray(e,t,r));i.content=e;return i};A.textToArray=function(e,t,r){if(r==null){r='"'}if(t==null){t=","}if(e.charCodeAt(0)==65279){e=e.substring(1)}var i=r+r;var l=[];var n=e.length;var s=e;var a=0;while(true){var h=n-a;var o=0;var u=0;var v=[];var f=null;var c=null;while(u<h){o=u;c=s.charAt(a+u);if(c=="\r"&&s.charAt(a+u+1)=="\n"){u+=2;break}if(c=="\n"){++u;break}if(c==t){f="";var _=a+u+1;if(_<n){c=s.charAt(_)}else{c="\n"}if(o==0||c==t||c=="\n"){++u;v.push("")}else if(c=="\r"&&s.charAt(a+u+2)=="\n"){u+=2;v.push("")}else{++u}}else if(c==r){++u;while(true){u=s.indexOf(r,a+u);if(u==-1){console.log("[ACsv] Invalid Double Quote");return null}u-=a;var d=a+u+1;if(d<n){if(s.charAt(d)==r){u+=2;continue}}break}f=s.substring(a+o+1,a+u);f=g.replace(f,i,r);v.push(f);++u}else{var b=s.indexOf(t,a+u);if(b==-1){b=h}else{b-=a}var w=s.indexOf("\n",a+u);if(w!=-1&&s.charAt(w-1)=="\r"){--w}if(w==-1){w=h}else{w-=a}u=b;if(w<b){u=w}f=s.substring(a+o,a+u);v.push(f)}}l.push(v);a+=u;if(a>=n){break}}return l};A.arrayToRows=function(e){var t=e.shift();var r=e;var i=[];var l=0;var n=t.length;while(l<n){var s=l++;var a=t[s];var h=a.split(":");var o=new x;o.fullName=a;o.name=h[0];o.type=h[1];i.push(o)}var u=0;var v=r.length;while(u<v){var f=u++;var c=r[f];var _=0;var d=c.length;while(_<d){var b=_++;var w=c[b];var g=w;var p=w==null||w=="";var y=i[b].type;if(y=="bool"){if(p||w=="false"||w=="0"){g=false}else{g=true}}else if(y=="int"){if(p){g=0}else{g=parseInt(w)}}else if(y=="number"){if(p){g=0}else{g=parseFloat(w)}}else if(y=="json"){if(p){g=null}else{var O=w.charAt(0);if(!(O=="["||O=="{")){console.log("[ACsv] Invalid json format:"+i[b].name+","+w);return null}g=w}}else if(y=="strings"){if(p){g="[]"}else{g='["'+w.split(",").join('","')+'"]'}}c[b]=g}r[f]=c}var m=new A;m.head=i;m.body=r;return m};A.prototype={merge:function(e){this.body=this.body.concat(e.body);var t=e.content.indexOf("\r\n");if(t==-1){t=e.content.indexOf("\n")}var r=e.content.substring(t);this.content+=r;return this},createIndexAt:function(e){var t={};var r=0;var i=this.body.length;while(r<i){var l=r++;var n=this.body[l];var s=n[e];t[s]=n}this._indexSet[e]=t},getColIndexBy:function(e){var t=0;var r=this.head.length;while(t<r){var i=t++;var l=this.head[i];if(l.name==e){return i}}return-1},id:function(e,t){if(t==null){t=0}return this.selectWhenE(1,e,t).toFirstObj()},sortBy:function(e,t){var r=this._selector.length;var i=0;var l=r;while(i<l){var n=i++;var s=0;var a=r-1;while(s<a){var h=s++;var o=false;var u=this._selector[h][e];var v=this._selector[h+1][e];if(t==0&&u>v){o=true}else if(t==1&&u<v){o=true}if(o){var f=this._selector[h];this._selector[h]=this._selector[h+1];this._selector[h+1]=f}}}return this},getCurrentSelector:function(){return this._selector},fmtRow:function(e){var t=[];var r=0;var i=this.head.length;while(r<i){var l=r++;var n=this.head[l];var s=n.type;var a=e[l];var h=null;if(s!=null&&s.length>0&&A.JSON_TYPES.indexOf(s)!=-1){if(a!=null){h=JSON.parse(a)}}else{h=a}t.push(h)}return t},fmtObj:function(e){var t={};var r=0;var i=this.head.length;while(r<i){var l=r++;var n=this.head[l];var s=n.name;var a=n.type;var h=e[l];var o=null;if(a!=null&&a.length>0&&A.JSON_TYPES.indexOf(a)!=-1){if(h!=null){o=JSON.parse(h)}}else{o=h}t[s]=o}return t},toFirstRow:function(){var e=null;if(this._selector!=null&&this._selector.length>0){e=this.fmtRow(this._selector[0])}this._selector=null;return e},toLastRow:function(){var e=null;if(this._selector!=null){var t=this._selector.length;if(t>0){e=this.fmtRow(this._selector[t-1])}}this._selector=null;return e},toRows:function(){if(this._selector==null){return null}var e=[];var t=0;var r=this._selector.length;while(t<r){var i=t++;var l=this._selector[i];e.push(this.fmtRow(l))}this._selector=null;return e},toFirstObj:function(){var e=null;if(this._selector!=null&&this._selector.length>0){e=this.fmtObj(this._selector[0])}this._selector=null;return e},toLastObj:function(){var e=null;if(this._selector!=null){var t=this._selector.length;if(t>0){e=this.fmtObj(this._selector[t-1])}}this._selector=null;return e},toObjs:function(){if(this._selector==null){return null}var e=[];var t=0;var r=this._selector.length;while(t<r){var i=t++;var l=this._selector[i];e.push(this.fmtObj(l))}this._selector=null;return e},toTable:function(){if(this._selector==null){return null}var e=new A;e.head=this.head.concat([]);e.body=this._selector;this._selector=null;return e},selectAll:function(){this._selector=this.body;return this},selectFirstRow:function(){this._selector=[this.body[0]];return this},selectLastRow:function(){this._selector=[this.body[this.body.length-1]];return this},selectAt:function(e){var t=[];var r=this.body.length;var i=0;var l=e.length;while(i<l){var n=i++;var s=e[n];if(s>=0&&s<r){t.push(this.body[s])}}this._selector=t;return this},selectWhenIn:function(e,t,r){if(r==null){r=0}var i=[];var l=0;var n=t.length;while(l<n){var s=l++;var a=t[s];this.selectWhenE(e,a,r,i);this._selector=null}this._selector=i;return this},selectWhenE:function(e,t,r,i){if(r==null){r=0}var l=i;if(l==null){l=[]}if(e==1){var n=this._indexSet[r];if(n!=null){var s=n[t];if(s!=null){l.push(s)}this._selector=l;return this}}var a=this._selector;if(a==null){a=this.body}var h=0;var o=a.length;while(h<o){var u=h++;var v=a[u];if(v[r]==t){l.push(v);--e;if(e==0){break}}}this._selector=l;return this},selectWhenE2:function(e,t,r,i,l){if(l==null){l=0}if(i==null){i=1}var n=this._selector;if(n==null){n=this.body}var s=[];var a=0;var h=n.length;while(a<h){var o=a++;var u=n[o];if(u[l]==t&&u[i]==r){s.push(u);--e;if(e==0){break}}}this._selector=s;return this},selectWhenE3:function(e,t,r,i,l,n,s){if(s==null){s=0}if(n==null){n=1}if(l==null){l=2}var a=this._selector;if(a==null){a=this.body}var h=[];var o=0;var u=a.length;while(o<u){var v=o++;var f=a[v];if(f[s]==t&&f[n]==r&&f[l]==i){h.push(f);--e;if(e==0){break}}}this._selector=h;return this},selectWhenG:function(e,t,r,i){if(i==null){i=0}var l=this._selector;if(l==null){l=this.body}var n=[];var s=0;var a=l.length;while(s<a){var h=s++;var o=l[h];var u=o[i];if(u>r||t&&u==r){n.push(o);--e;if(e==0){break}}}this._selector=n;return this},selectWhenL:function(e,t,r,i){if(i==null){i=0}var l=this._selector;if(l==null){l=this.body}var n=[];var s=0;var a=l.length;while(s<a){var h=s++;var o=l[h];var u=o[i];if(u<r||t&&u==r){n.push(o);--e;if(e==0){break}}}this._selector=n;return this},selectWhenGreaterAndLess:function(e,t,r,i,l,n){if(n==null){n=0}var s=this._selector;if(s==null){s=this.body}var a=[];var h=0;var o=s.length;while(h<o){var u=h++;var v=s[u];var f=v[n];var c=f>i||t&&f==i;var _=f<l||r&&f==l;if(c&&_){a.push(v);--e;if(e==0){break}}}this._selector=a;return this},selectWhenLessOrGreater:function(e,t,r,i,l,n){if(n==null){n=0}var s=this._selector;if(s==null){s=this.body}var a=[];var h=0;var o=s.length;while(h<o){var u=h++;var v=s[u];var f=v[n];var c=f<i||t&&f==i;var _=f>l||r&&f==l;if(c||_){a.push(v);--e;if(e==0){break}}}this._selector=a;return this}};A.JSON_TYPES=["json","strings"]})(typeof exports!="undefined"?exports:typeof window!="undefined"?window:typeof self!="undefined"?self:this);